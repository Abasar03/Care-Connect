{% extends 'base.html' %}

{% block content %}
<h2 class="text-center text-3xl font-bold text-sky-600 mb-6">Register</h2>
<form method="POST" action="{% url 'register' %}" class="max-w-md mx-auto p-6 bg-white border border-blue-300 rounded-lg shadow-md">
    {% csrf_token %}
    
    <!-- Role Selection -->
    <label for="role" class="block font-semibold mb-2">Role:</label>
    <select name="role" id="role" onchange="toggleFields()" required class="w-full p-2 mb-4 border border-blue-300 rounded-lg focus:ring-2 focus:ring-sky-500">
        <option value="doctor">Doctor</option>
        <option value="patient">Patient</option>
    </select>

    <!-- Doctor-specific Fields -->
    <div id="doctor-fields" style="display:none;">
        <input type="text" name="name" placeholder="Name" required class="w-full p-2 mb-4 border border-blue-300 rounded-lg focus:ring-2 focus:ring-sky-500">
        <input type="email" name="email" placeholder="Email" required class="w-full p-2 mb-4 border border-blue-300 rounded-lg focus:ring-2 focus:ring-sky-500">
        <input type="password" name="password" placeholder="Password" required class="w-full p-2 mb-4 border border-blue-300 rounded-lg focus:ring-2 focus:ring-sky-500">

        <label for="dep_id" class="block font-semibold mb-2">Department:</label>
        <select name="dep_id" id="dep_id" required class="w-full p-2 mb-4 border border-blue-300 rounded-lg focus:ring-2 focus:ring-sky-500">
            {% for dep_id, name in departments %}
            <option value="{{ dep_id }}">{{ name }}</option>
            {% endfor %}
        </select>

        <label for="schedule" class="block font-semibold mb-2">Schedule:</label>
        <select name="schedule" id="schedule" required class="w-full p-2 mb-4 border border-blue-300 rounded-lg focus:ring-2 focus:ring-sky-500">
            <option value="free">Free</option>
            <option value="busy">Busy</option>
        </select>

        <input type="number" name="contact_num" placeholder="Contact Number" required class="w-full p-2 mb-4 border border-blue-300 rounded-lg focus:ring-2 focus:ring-sky-500">
    </div>

    <!-- Patient-specific Fields -->
    <div id="patient-fields" style="display:none;">
        <input type="text" name="name" placeholder="Name" required class="w-full p-2 mb-4 border border-blue-300 rounded-lg focus:ring-2 focus:ring-sky-500">
        <input type="email" name="email" placeholder="Email" required class="w-full p-2 mb-4 border border-blue-300 rounded-lg focus:ring-2 focus:ring-sky-500">
        <input type="password" name="password" placeholder="Password" required class="w-full p-2 mb-4 border border-blue-300 rounded-lg focus:ring-2 focus:ring-sky-500">
        <input type="number" name="age" placeholder="Age" class="w-full p-2 mb-4 border border-blue-300 rounded-lg focus:ring-2 focus:ring-sky-500">

        <label for="gender" class="block font-semibold mb-2">Gender:</label>
        <select name="gender" id="gender" required class="w-full p-2 mb-4 border border-blue-300 rounded-lg focus:ring-2 focus:ring-sky-500">
            <option value="male">Male</option>
            <option value="female">Female</option>
        </select>

        <input type="number" name="contact_num" placeholder="Contact Number" required class="w-full p-2 mb-4 border border-blue-300 rounded-lg focus:ring-2 focus:ring-sky-500">
        <textarea name="address" placeholder="Address" class="w-full p-2 mb-4 border border-blue-300 rounded-lg focus:ring-2 focus:ring-sky-500"></textarea>
    </div>

    <!-- Submit Button -->
    <button type="submit" class="w-full p-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-200">Register</button>
</form>

<!-- Link to Login Page -->
<p class="text-center mt-4">Already have an account? <a href="{% url 'login' %}" class="text-sky-500 hover:underline">Login here</a></p>

<!-- JavaScript to Toggle Fields Based on Role -->
<script>
    function toggleFields() {
        var role = document.getElementById('role').value;

        var doctorFields = document.getElementById('doctor-fields');
        var patientFields = document.getElementById('patient-fields');

        if (role === 'doctor') {
            doctorFields.style.display = 'block';
            patientFields.style.display = 'none';
        } else if (role === 'patient') {
            doctorFields.style.display = 'none';
            patientFields.style.display = 'block';
        }
    }

    // Initialize the correct fields visibility on page load
    window.onload = function() {
        toggleFields();
    };
</script>

{% endblock %}