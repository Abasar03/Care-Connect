{% extends 'base.html' %}

{% block content %}
<h2>Register</h2>
<form method="POST" action="{% url 'register' %}">
    {% csrf_token %}
    
    <!-- Role Selection -->
    <label for="role">Role:</label>
    <select name="role" id="role" onchange="toggleFields()" required>
        <option value="doctor">Doctor</option>
        <option value="patient">Patient</option>
    </select><br>

    <!-- Common Fields -->

    <!-- Doctor-specific Fields -->
    <div id="doctor-fields" style="display:none;">
        <input type="text" name="name" placeholder="Name" required><br>
        <input type="email" name="email" placeholder="Email" required><br>
        <input type="password" name="password" placeholder="Password" required><br>

        <label for="dep_id">Department:</label>
        <select name="dep_id" id="dep_id" required>
            {% for dep_id,name in departments %}
            <option value="{{ dep_id }}">{{ name }}</option>
            {% endfor %}
        </select><br>

        <label for="schedule">Schedule:</label>
        <select name="schedule" id="schedule" required>
            <option value="free">Free</option>
            <option value="busy">Busy</option>
        </select><br>

        <input type="number" name="contact_num" placeholder="Contact Number" required><br>
    </div>

    <!-- Patient-specific Fields -->
    <div id="patient-fields" style="display:none;">
        <input type="text" name="name" placeholder="Name" required><br>
        <input type="email" name="email" placeholder="Email" required><br>
        <input type="password" name="password" placeholder="Password" required><br>
        <input type="number" name="age" placeholder="Age"><br>

        <label for="gender">Gender:</label>
        <select name="gender" id="gender" required>
            <option value="male">Male</option>
            <option value="female">Female</option>
        </select><br>

        <input type="number" name="contact_num" placeholder="Contact Number" required><br>
        <textarea name="address" placeholder="Address"></textarea><br>
    </div>

    <!-- Submit Button -->
    <button type="submit">Register</button>
</form>

<!-- Link to Login Page -->
<p>Already have an account? <a href="{% url 'login' %}">Login here</a></p>

<!-- JavaScript to Toggle Fields Based on Role -->
<script>
    function toggleFields() {
    var role = document.getElementById('role').value;

    var doctorFields = document.getElementById('doctor-fields');
    var patientFields = document.getElementById('patient-fields');

    if (role === 'doctor') {
        doctorFields.style.display = 'block';
        patientFields.style.display = 'none';

        // Add required attributes to doctor fields
        addRequiredAttributes(doctorFields);
        removeRequiredAttributes(patientFields);
    } else if (role === 'patient') {
        doctorFields.style.display = 'none';
        patientFields.style.display = 'block';

        // Add required attributes to patient fields
        addRequiredAttributes(patientFields);
        removeRequiredAttributes(doctorFields);
    }
}

function addRequiredAttributes(fieldsContainer) {
    var inputs = fieldsContainer.querySelectorAll('input, select, textarea');
    inputs.forEach(function(input) {
        input.setAttribute('required', 'true');
    });
}

function removeRequiredAttributes(fieldsContainer) {
    var inputs = fieldsContainer.querySelectorAll('input, select, textarea');
    inputs.forEach(function(input) {
        input.removeAttribute('required');
    });
}

// Initialize the correct fields visibility on page load
window.onload = function() {
    toggleFields();
};

</script>

{% endblock %}
